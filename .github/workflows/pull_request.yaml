name: "Pull Request"
on:
  pull_request:
    branches:
      - trunk
  workflow_dispatch:

jobs:
  vaultTest:
    name: Execute integration tests
    runs-on: ubuntu-20.04
    permissions:
      id-token: write
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Acquire AWS credentials
        uses: zarnovican/aws-oidc-login-action@v1.0.2
        with:
          role: "arn:aws:iam::068845349622:role/GHA-yardbirdsax-goawsssm"
          aws-region: us-east-2
          client-id: sigstore
      - name: debug
        run: "curl -H \"Authorization: bearer $ACTIONS_ID_TOKEN_REQUEST_TOKEN\" \"$ACTIONS_ID_TOKEN_REQUEST_URL\""
        shell: bash
      - name: Install Terraform
        uses: hashicorp/setup-terraform@v1
        with:
          terraform_version: 1.0.8
          terraform_wrapper: false
      - name: Run Go tests
        uses: ./.github/actions/test
        with:
          go-version: 1.16